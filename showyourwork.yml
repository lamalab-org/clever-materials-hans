# Enable rule caching on Zenodo?
cache_on_zenodo: true

# Workflow graph (DAG) generation
dag:
  # Generate `dag.pdf` on each build?
  render: false
  # Graphviz layout engine
  engine: sfdp
  # Group files by type into plates?
  group_by_type: false
  # Custom graph attributes
  graph_attr:
    ranksep: "1"
    nodesep: "0.65"
  # Custom node attributes
  node_attr:
    shape: "box"
    penwidth: "2"
    width: "1"
  # Files and glob patterns to ignore
  # ignore_files:
  #  - src/tex/orcid-ID.png


# Snakemake rules for data processing and analysis pipeline
rules:
  # Preprocessing rules - generate parquet files from raw data
  preprocess_batteries:
    input:
      - src/data/battery_merged.csv
      - src/scripts/utils.py
      - src/scripts/descriptor_generation.py
      - src/scripts/meta_enchrichment.py
      - src/scripts/paths.py
    output:
      - src/tex/output/battery_preprocessed.parquet
    script: src/scripts/preprocess-batteries.py
    
  preprocess_perovskites:
    input:
      - src/data/perovskite_solar_cell_database.parquet
      - src/scripts/utils.py
      - src/scripts/descriptor_generation.py
      - src/scripts/meta_enchrichment.py
      - src/scripts/paths.py
    output:
      - src/tex/output/perovskite_processed.parquet
    script: src/scripts/preprocess-perovskites.py
    
  preprocess_tadf:
    input:
      - src/data/tadf.csv
      - src/scripts/utils.py
      - src/scripts/descriptor_generation.py
      - src/scripts/meta_enchrichment.py
      - src/scripts/paths.py
    output:
      - src/tex/output/tadf_processed.parquet
    script: src/scripts/preprocess-tadf.py
    
  preprocess_mof:
    input:
      - src/data/thermal_stability.json
      - src/data/solvent_removal_stability.json
      - src/scripts/utils.py
      - src/scripts/descriptor_generation.py
      - src/scripts/meta_enchrichment.py
      - src/scripts/paths.py
    output:
      - src/tex/output/mof_thermal_stability.parquet
      - src/tex/output/mof_solvent_stability.parquet
    script: src/scripts/preprocess-mof.py
    
  # Analysis rules - generate figures and metrics from preprocessed data
  analyze_tadf:
    input:
      - src/tex/output/tadf_processed.parquet
      - src/scripts/utils.py
      - src/scripts/plotting_utils.py
      - src/scripts/paths.py
    output:
      - src/tex/figures/tadf_performance_comparison.pdf
      - src/tex/figures/tadf_meta_performance.pdf
      - src/tex/figures/tadf_parameter_sweep.pdf
      - src/tex/figures/tadf_main_panel.pdf
      - src/tex/figures/tadf_main_panel_four_columns.pdf
      - src/tex/output/tadf_accuracy.txt
      - src/tex/output/tadf_mae.txt
      - src/tex/output/tadf_r2.txt
      - src/tex/output/tadf_best_meta_accuracy.txt
      - src/tex/output/tadf_best_dataset_size.txt
      - src/tex/output/tadf_n_features.txt
    script: src/scripts/analyze-tadf.py
    
  analyze_batteries:
    input:
      - src/tex/output/battery_preprocessed.parquet
      - src/scripts/utils.py
      - src/scripts/plotting_utils.py
      - src/scripts/paths.py
    output:
      - src/tex/figures/battery_performance_comparison.pdf
      - src/tex/figures/battery_meta_performance.pdf
      - src/tex/figures/battery_parameter_sweep.pdf
      - src/tex/figures/battery_main_panel.pdf
      - src/tex/figures/battery_main_panel_four_columns.pdf
      - src/tex/output/battery_accuracy.txt
      - src/tex/output/battery_mae.txt
      - src/tex/output/battery_r2.txt
    script: src/scripts/analyze-batteries.py
    
  analyze_batteries_top10:
    input:
      - src/tex/output/battery_preprocessed.parquet
      - src/scripts/utils.py
      - src/scripts/plotting_utils.py
      - src/scripts/paths.py
    output:
      - src/tex/figures/battery_top10_performance_comparison.pdf
      - src/tex/figures/battery_top10_meta_performance.pdf
      - src/tex/figures/battery_top10_parameter_sweep.pdf
      - src/tex/figures/battery_top10_main_panel.pdf
      - src/tex/figures/battery_top10_main_panel_four_columns.pdf
      - src/tex/output/battery_top10_accuracy.txt
      - src/tex/output/battery_top10_f1.txt
      - src/tex/output/battery_top10_author_f1_micro.txt
      - src/tex/output/battery_dataset_size.txt
      - src/tex/output/battery_n_features.txt
    script: src/scripts/analyze-batteries-top10.py
    
  analyze_perovskites:
    input:
      - src/tex/output/perovskite_processed.parquet
      - src/scripts/utils.py
      - src/scripts/plotting_utils.py
      - src/scripts/paths.py
    output:
      - src/tex/figures/perovskite_performance_comparison.pdf
      - src/tex/figures/perovskite_meta_performance.pdf
      - src/tex/figures/perovskite_parameter_sweep.pdf
      - src/tex/figures/perovskite_main_panel.pdf
      - src/tex/figures/perovskite_main_panel_four_columns.pdf
      - src/tex/output/perovskite_accuracy.txt
      - src/tex/output/perovskite_mae.txt
      - src/tex/output/perovskite_r2.txt
      - src/tex/output/perovskite_dataset_size.txt
      - src/tex/output/perovskite_n_features.txt
    script: src/scripts/analyze-perovskites.py
    
  analyze_perovskites_top10:
    input:
      - src/tex/output/perovskite_processed.parquet
      - src/scripts/utils.py
      - src/scripts/plotting_utils.py
      - src/scripts/paths.py
    output:
      - src/tex/figures/perovskite_top10_performance_comparison.pdf
      - src/tex/figures/perovskite_top10_meta_performance.pdf
      - src/tex/figures/perovskite_top10_parameter_sweep.pdf
      - src/tex/figures/perovskite_top10_main_panel.pdf
      - src/tex/figures/perovskite_top10_main_panel_four_columns.pdf
      - src/tex/output/perovskite_top10_accuracy.txt
      - src/tex/output/perovskite_top10_f1.txt
      - src/tex/output/perovskite_top10_author_f1_micro.txt
      - src/tex/output/perovskite_top10_indirect_accuracy.txt
      - src/tex/output/perovskite_top10_direct_accuracy.txt
    script: src/scripts/analyze-perovskites-top10.py
    
  analyze_perovskites_jsc:
    input:
      - src/tex/output/perovskite_processed.parquet
      - src/scripts/utils.py
      - src/scripts/plotting_utils.py
      - src/scripts/paths.py
    output:
      - src/tex/figures/perovskite_jsc_performance_comparison.pdf
      - src/tex/figures/perovskite_jsc_meta_performance.pdf
      - src/tex/figures/perovskite_jsc_parameter_sweep.pdf
      - src/tex/figures/perovskite_jsc_main_panel.pdf
      - src/tex/figures/perovskite_jsc_main_panel_four_columns.pdf
      - src/tex/output/perovskite_jsc_accuracy.txt
      - src/tex/output/perovskite_jsc_mae.txt
      - src/tex/output/perovskite_jsc_r2.txt
    script: src/scripts/analyze-perovskites-jsc.py
    
  analyze_perovskites_voc:
    input:
      - src/tex/output/perovskite_processed.parquet
      - src/scripts/utils.py
      - src/scripts/plotting_utils.py
      - src/scripts/paths.py
    output:
      - src/tex/figures/perovskite_voc_performance_comparison.pdf
      - src/tex/figures/perovskite_voc_meta_performance.pdf
      - src/tex/figures/perovskite_voc_parameter_sweep.pdf
      - src/tex/figures/perovskite_voc_main_panel.pdf
      - src/tex/figures/perovskite_voc_main_panel_four_columns.pdf
      - src/tex/output/perovskite_voc_accuracy.txt
      - src/tex/output/perovskite_voc_mae.txt
      - src/tex/output/perovskite_voc_r2.txt
    script: src/scripts/analyze-perovskites-voc.py
    
  analyze_mof_thermal:
    input:
      - src/tex/output/mof_thermal_stability.parquet
      - src/scripts/utils.py
      - src/scripts/plotting_utils.py
      - src/scripts/paths.py
    output:
      - src/tex/figures/mof_thermal_performance_comparison.pdf
      - src/tex/figures/mof_thermal_meta_performance.pdf
      - src/tex/figures/mof_thermal_parameter_sweep.pdf
      - src/tex/figures/mof_thermal_main_panel.pdf
      - src/tex/figures/mof_thermal_main_panel_four_columns.pdf
      - src/tex/output/mof_thermal_accuracy.txt
      - src/tex/output/mof_thermal_mae.txt
      - src/tex/output/mof_thermal_r2.txt
      - src/tex/output/mof_thermal_dataset_size.txt
      - src/tex/output/mof_thermal_n_features.txt
    script: src/scripts/analyze-mof-thermal-stability.py
    
  analyze_mof_thermal_top10:
    input:
      - src/tex/output/mof_thermal_stability.parquet
      - src/scripts/utils.py
      - src/scripts/plotting_utils.py
      - src/scripts/paths.py
    output:
      - src/tex/figures/mof_thermal_top10_performance_comparison.pdf
      - src/tex/figures/mof_thermal_top10_meta_performance.pdf
      - src/tex/figures/mof_thermal_top10_parameter_sweep.pdf
      - src/tex/figures/mof_thermal_top10_main_panel.pdf
      - src/tex/figures/mof_thermal_top10_main_panel_four_columns.pdf
      - src/tex/output/mof_thermal_top10_accuracy.txt
      - src/tex/output/mof_thermal_top10_f1.txt
      - src/tex/output/mof_thermal_top10_indirect_accuracy.txt
      - src/tex/output/mof_thermal_top10_direct_accuracy.txt
    script: src/scripts/analyze-mof-thermal-top10.py
    
  analyze_mof_solvent:
    input:
      - src/tex/output/mof_solvent_stability.parquet
      - src/scripts/utils.py
      - src/scripts/plotting_utils.py
      - src/scripts/paths.py
    output:
      - src/tex/figures/mof_solvent_performance_comparison.pdf
      - src/tex/figures/mof_solvent_meta_performance.pdf
      - src/tex/figures/mof_solvent_parameter_sweep.pdf
      - src/tex/figures/mof_solvent_main_panel.pdf
      - src/tex/figures/mof_solvent_main_panel_four_columns.pdf
      - src/tex/output/mof_solvent_accuracy.txt
      - src/tex/output/mof_solvent_f1.txt
      - src/tex/output/mof_solvent_indirect_accuracy.txt
      - src/tex/output/mof_solvent_dataset_size.txt
      - src/tex/output/mof_solvent_n_features.txt
    script: src/scripts/analyze-mof-solvent-stability.py
    
  analyze_tadf_meta_comparison:
    input:
      - src/tex/output/tadf_processed.parquet
      - src/scripts/utils.py
      - src/scripts/plotting_utils.py
      - src/scripts/paths.py
    output:
      - src/tex/figures/tadf_meta_comparison.pdf
      - src/tex/figures/tadf_meta_main_panel_four_columns.pdf
    script: src/scripts/analyze-tadf-meta-comparison.py

# Custom file dependencies
dependencies:
  # Preprocessing scripts depend on raw data
  src/scripts/preprocess-batteries.py:
    - src/data/battery_merged.csv
    
  src/scripts/preprocess-perovskites.py:
    - src/data/perovskite_solar_cell_database.parquet
    
  src/scripts/preprocess-tadf.py:
    - src/data/tadf.csv
    
  src/scripts/preprocess-mof.py:
    - src/data/thermal_stability.json
    - src/data/solvent_removal_stability.json

  # Additional dependencies for utility modules
  src/scripts/utils.py:
    - environment.yml  # Ensure ML packages are available
    
  src/scripts/plotting_utils.py:
    - environment.yml  # Ensure plotting packages are available
    - src/scripts/utils.py
    
  src/scripts/descriptor_generation.py:
    - environment.yml  # Ensure chemistry packages (rdkit, pymatgen, matminer) are available
    
  src/scripts/meta_enchrichment.py:
    - environment.yml  # Ensure API packages (habanero, crossref-commons) are available
    
  # TeX file dependencies
  src/tex/ms.tex:
    - src/tex/preamble.tex
    - src/tex/authors.tex
    - src/tex/figures/overview.tex
    - src/tex/figures/toc.png

# Name of the `.tex` manuscript and corresponding `.pdf` article
ms_name: ms

# Optimize DAG by removing unnecessary jobs upstream of cache hits?
optimize_caching: false

# Overleaf sync settings
overleaf:
  # Overleaf project ID (blank = disabled)
  id: 
  # Perform sync on GitHub Actions?
  gh_actions_sync: true
  # List of files to push to Overleaf
  push:
    - src/tex/figures
    - src/tex/output
  # List of files to pull from Overleaf
  pull:
    - src/tex/ms.tex
    - src/tex/bib.bib

# Always require all input files to be present on disk for workflow to pass?
require_inputs: true

# Allow cacheable rules to run on GitHub Actions?
run_cache_rules_on_ci: false

# Mapping of script file extensions to instructions for executing them
scripts:
  py: python {script}

# Display of the `showyourwork` stamp on first page
stamp:
  # Show the stamp?
  enabled: false
  # Stamp angle in degrees
  angle: -20.0
  # Stamp size in inches
  size: 0.75
  # Horizontal position in inches from right edge of paper
  xpos: 0.50
  # Vertical position in inches from top edge of paper
  ypos: 0.50
  # Display of the repo URL in the stamp
  url:
    # Show the URL?
    enabled: true
    # Maximum URL length to display
    maxlen: 40

# Enable SyncTeX?
synctex: True

# Command-line options to be passed to tectonic when building the manuscript
tectonic_args: []

# Preprocessing script for arXiv tarball
# (such as to switch `minted` from `finalizecache` to `frozencache`)
# The script will be passed a directory containing the manuscript source
# as input, and should modify the contents of that directory in-place.
# preprocess_arxiv_script: my_preprocess_script.sh

# Enable verbose output?
verbose: true

# Version of `showyourwork` used to create this workflow
version: 0.4.4.dev274+gf6ad741ab
